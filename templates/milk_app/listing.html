<!DOCTYPE html>

{% extends 'milk_app/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title_block %}

    {% if listing %}
        {{ listing.name }}
    {% else %}
        Listing does not exist.
    {% endif %}

{% endblock %}

{% block body_block %}

<div class="jumbotron">
    <div class="text-center">
        <h1 class="display-4">You're vieweing listing: {{ listing.name }}</h1>
            {% if listing %}
            <!-- What everyone sees -->
            <h2 class="display-6"> Univeristy:  {{ listing.univeristy }}</h2>
            <h2 class="display-10">Address: {{listing.address}}</h2>
            <h2 class="display-10">Rating: {{listing.rating}}</h2>
            <h2 class="display-10">Owner: {{owner_info.user.username}}</h2>
            
                
                {% if listing.picture %}
                    <img src = "/media/{{listing.picture}}" height = "10%" width= "10%"></img>
                {% endif %}
                
                
                <!-- Logic behind How listing should look for Host/tenant -->
                <!-- If you are a Tenant and it is not your listing -->
                {% if user.userprofile.account == 'Tenant' and owner_info.user.username != user.userprofile.user.username %} 
                <h2 class="display-10">Date added: {{listing.date}}</h2>
                <form action = "{% url 'milk_app:purchase_listing' listing.slug %}" method = 'POST'> 
                    {% csrf_token %}
                    <button class = "btn btn-outline-light btn-lg" type = 'submit'> Rent Listing</button>
                </form>
                <!-- If you are tenant and it is your listing -->
                {% elif user.userprofile.account == 'Tenant' and owner_info.user.username == user.userprofile.user.username %}
                <h2 class="display-10">Date Purchased: {{listing.date}}</h2>

                <!-- If you are a Host view -->
                {% elif user.userprofile.account == 'Host' and owner_info.user.username == user.userprofile.user.username %}
                <h2 class="display-10">Date added: {{listing.date}}</h2>
                
                <form action = "{% url 'milk_app:remove_listing' listing.slug %}" method = 'POST'> 
                    {% csrf_token %}
                    <button class = "btn btn-outline-dark btn-lg" type = 'submit'> Remove Listing</button>
                </form>



                <div> <button class = "btn btn-outline-dark btn-lg" type="button" id="formButton"> Update Listing </button></div> 

                <form style="display: none;" id = "update_form" method='POST' enctype="multipart/form-data" action="{% url 'milk_app:show_listing' listing.slug %} ">
                    {%csrf_token%}

                    {{updated_listing|crispy}}

                    <button class = "btn btn-outline-dark btn-lg" type='submit' name = 'submit'>Confirm Changes</button>
                </form>

                
                <!-- If not authenticated -->
                {% else %}

                <h2 class="display-10">Date added: {{listing.date}}</h2>

                {% endif %}

                {% else %}
                Listing does not exist.
            
                {% endif %}
            
    </div>
</div>
{% endblock %}